
/*
  * nerve
  * http://r1cebank.github.io/Nerve/
 #
  * Copyright (c) 2014 r1cebank
  * Licensed under the MIT license.
 */

(function() {
  var app, bodyParser, chalk, d, express, guest, http, io, mongo, mongourl, port, raygun, raygunClient, winston;

  require('newrelic');

  express = require('express');

  app = express();

  http = require('http').Server(app);

  io = require('socket.io')(http);

  bodyParser = require('body-parser');

  mongo = require('mongodb').MongoClient;

  chalk = require('chalk');

  winston = require('winston');

  winston.cli();

  if (!process.env.PRODUCTION) {
    chalk.enabled = true;
    chalk.supportsColor = true;
    winston.info('Forcing chalk color support.');
  }

  if (process.env.PRODUCTION != null) {
    raygun = require('raygun');
    raygunClient = new raygun.Client().init({
      apiKey: 'MJqfCmhfsVzK8wR3TML/Fw=='
    });
  }

  d = require('domain').create();

  d.on('error', function(err) {
    return raygunClient.send(err, {}, function() {
      return process.exit();
    });
  });

  port = process.env.PORT || 3939;

  module.exports = function(options) {
    var VERBOSE;
    return VERBOSE = options;
  };

  mongourl = 'mongodb://nerved:CphV7caUpdYRR9@ds041561.mongolab.com:41561/heroku_app33695157';

  guest = {
    name: "guest",
    email: "nerve-guest@gmail.com",
    profession: "guest",
    talents: "guesting"
  };

  app.use(bodyParser.urlencoded({
    extended: false
  }));

  app.use('/css', express["static"](process.cwd() + '/www/css'));

  app.use('/img', express["static"](process.cwd() + '/www/img'));

  app.use('/js', express["static"](process.cwd() + '/www/js'));

  app.use(function(err, req, res, next) {
    return raygunClient.send(err, {
      request: req,
      response: res,
      next: next
    });
  });

  app.get('/', function(req, res) {
    return res.sendFile(process.cwd() + '/www/index.html');
  });

  app.post('/login', function(req, res) {
    return res.send("user: " + req.body.user + " pass: " + req.body.pass);
  });

  mongo.connect(mongourl, function(err, db) {
    var profiles, server, users;
    if (err != null) {
      winston.error('filed to connect nerve database');
      raygunClient.send(err);
      process.exit();
    }
    winston.info('connected to database.');
    users = db.collection('users');
    profiles = db.collection('profiles');
    server = exports.server = http.listen(port, function() {
      var host;
      host = server.address().address;
      port = server.address().port;
      return winston.info('server started at http://' + host + ':' + port);
    });

    /*
    post {
      author: "",
      title: "",
      description: "",
      tags: {},
      requirement: {}, //tags and requirement are automatically generated as user input
      status: "",
      comp: "",
      location: "",
      remark: "",
      date: "",
    }
     */
    server.on('error', function(err) {
      return raygunClient.send(err);
    });
    return io.on('connection', function(socket) {
      return require('./events.js')(socket);
    });
  });

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5lcnZlLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUFBOzs7Ozs7R0FBQTtBQUFBO0FBQUE7QUFBQSxNQUFBLHlHQUFBOztBQUFBLEVBT0EsT0FBQSxDQUFTLFVBQVQsQ0FQQSxDQUFBOztBQUFBLEVBUUEsT0FBQSxHQUFVLE9BQUEsQ0FBUyxTQUFULENBUlYsQ0FBQTs7QUFBQSxFQVNBLEdBQUEsR0FBTSxPQUFBLENBQUEsQ0FUTixDQUFBOztBQUFBLEVBVUEsSUFBQSxHQUFPLE9BQUEsQ0FBUyxNQUFULENBQWUsQ0FBQyxNQUFoQixDQUF1QixHQUF2QixDQVZQLENBQUE7O0FBQUEsRUFXQSxFQUFBLEdBQUssT0FBQSxDQUFTLFdBQVQsQ0FBQSxDQUFxQixJQUFyQixDQVhMLENBQUE7O0FBQUEsRUFZQSxVQUFBLEdBQWEsT0FBQSxDQUFTLGFBQVQsQ0FaYixDQUFBOztBQUFBLEVBYUEsS0FBQSxHQUFRLE9BQUEsQ0FBUyxTQUFULENBQWtCLENBQUMsV0FiM0IsQ0FBQTs7QUFBQSxFQWNBLEtBQUEsR0FBUSxPQUFBLENBQVMsT0FBVCxDQWRSLENBQUE7O0FBQUEsRUFlQSxPQUFBLEdBQVUsT0FBQSxDQUFTLFNBQVQsQ0FmVixDQUFBOztBQUFBLEVBZ0JBLE9BQU8sQ0FBQyxHQUFSLENBQUEsQ0FoQkEsQ0FBQTs7QUFrQkEsRUFBQSxJQUFHLENBQUEsT0FBVyxDQUFDLEdBQUcsQ0FBQyxVQUFuQjtBQUNFLElBQUEsS0FBSyxDQUFDLE9BQU4sR0FBZ0IsSUFBaEIsQ0FBQTtBQUFBLElBQ0EsS0FBSyxDQUFDLGFBQU4sR0FBc0IsSUFEdEIsQ0FBQTtBQUFBLElBRUEsT0FBTyxDQUFDLElBQVIsQ0FBYyw4QkFBZCxDQUZBLENBREY7R0FsQkE7O0FBdUJBLEVBQUEsSUFBRyw4QkFBSDtBQUNFLElBQUEsTUFBQSxHQUFTLE9BQUEsQ0FBUyxRQUFULENBQVQsQ0FBQTtBQUFBLElBQ0EsWUFBQSxHQUFtQixJQUFBLE1BQU0sQ0FBQyxNQUFQLENBQUEsQ0FBZSxDQUFDLElBQWhCLENBQ2pCO0FBQUEsTUFBQSxNQUFBLEVBQVMsMEJBQVQ7S0FEaUIsQ0FEbkIsQ0FERjtHQXZCQTs7QUFBQSxFQTRCQSxDQUFBLEdBQUksT0FBQSxDQUFTLFFBQVQsQ0FBaUIsQ0FBQyxNQUFsQixDQUFBLENBNUJKLENBQUE7O0FBQUEsRUE2QkEsQ0FBQyxDQUFDLEVBQUYsQ0FBTSxPQUFOLEVBQWMsU0FBQyxHQUFELEdBQUE7V0FDWixZQUFZLENBQUMsSUFBYixDQUFrQixHQUFsQixFQUF1QixFQUF2QixFQUEyQixTQUFBLEdBQUE7YUFDekIsT0FBTyxDQUFDLElBQVIsQ0FBQSxFQUR5QjtJQUFBLENBQTNCLEVBRFk7RUFBQSxDQUFkLENBN0JBLENBQUE7O0FBQUEsRUFpQ0EsSUFBQSxHQUFPLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBWixJQUFvQixJQWpDM0IsQ0FBQTs7QUFBQSxFQW1DQSxNQUFNLENBQUMsT0FBUCxHQUFpQixTQUFDLE9BQUQsR0FBQTtBQUNmLFFBQUEsT0FBQTtXQUFBLE9BQUEsR0FBVSxRQURLO0VBQUEsQ0FuQ2pCLENBQUE7O0FBQUEsRUFzQ0EsUUFBQSxHQUFZLGdGQXRDWixDQUFBOztBQUFBLEVBd0NBLEtBQUEsR0FDRTtBQUFBLElBQUEsSUFBQSxFQUFPLE9BQVA7QUFBQSxJQUNBLEtBQUEsRUFBUSx1QkFEUjtBQUFBLElBRUEsVUFBQSxFQUFhLE9BRmI7QUFBQSxJQUdBLE9BQUEsRUFBVSxVQUhWO0dBekNGLENBQUE7O0FBQUEsRUE4Q0EsR0FBRyxDQUFDLEdBQUosQ0FBUSxVQUFVLENBQUMsVUFBWCxDQUFzQjtBQUFBLElBQUEsUUFBQSxFQUFVLEtBQVY7R0FBdEIsQ0FBUixDQTlDQSxDQUFBOztBQUFBLEVBK0NBLEdBQUcsQ0FBQyxHQUFKLENBQVMsTUFBVCxFQUFnQixPQUFPLENBQUMsUUFBRCxDQUFQLENBQWUsT0FBTyxDQUFDLEdBQVIsQ0FBQSxDQUFBLEdBQWlCLFVBQWhDLENBQWhCLENBL0NBLENBQUE7O0FBQUEsRUFnREEsR0FBRyxDQUFDLEdBQUosQ0FBUyxNQUFULEVBQWdCLE9BQU8sQ0FBQyxRQUFELENBQVAsQ0FBZSxPQUFPLENBQUMsR0FBUixDQUFBLENBQUEsR0FBaUIsVUFBaEMsQ0FBaEIsQ0FoREEsQ0FBQTs7QUFBQSxFQWlEQSxHQUFHLENBQUMsR0FBSixDQUFTLEtBQVQsRUFBZSxPQUFPLENBQUMsUUFBRCxDQUFQLENBQWUsT0FBTyxDQUFDLEdBQVIsQ0FBQSxDQUFBLEdBQWlCLFNBQWhDLENBQWYsQ0FqREEsQ0FBQTs7QUFBQSxFQWtEQSxHQUFHLENBQUMsR0FBSixDQUFRLFNBQUMsR0FBRCxFQUFNLEdBQU4sRUFBVyxHQUFYLEVBQWdCLElBQWhCLEdBQUE7V0FDTixZQUFZLENBQUMsSUFBYixDQUFrQixHQUFsQixFQUNFO0FBQUEsTUFBQSxPQUFBLEVBQVMsR0FBVDtBQUFBLE1BQ0EsUUFBQSxFQUFVLEdBRFY7QUFBQSxNQUVBLElBQUEsRUFBTSxJQUZOO0tBREYsRUFETTtFQUFBLENBQVIsQ0FsREEsQ0FBQTs7QUFBQSxFQXdEQSxHQUFHLENBQUMsR0FBSixDQUFTLEdBQVQsRUFBYSxTQUFDLEdBQUQsRUFBTSxHQUFOLEdBQUE7V0FDWCxHQUFHLENBQUMsUUFBSixDQUFhLE9BQU8sQ0FBQyxHQUFSLENBQUEsQ0FBQSxHQUFpQixpQkFBOUIsRUFEVztFQUFBLENBQWIsQ0F4REEsQ0FBQTs7QUFBQSxFQTREQSxHQUFHLENBQUMsSUFBSixDQUFVLFFBQVYsRUFBbUIsU0FBQyxHQUFELEVBQU0sR0FBTixHQUFBO1dBQ2pCLEdBQUcsQ0FBQyxJQUFKLENBQVUsUUFBQSxHQUFVLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBbkIsR0FBMkIsU0FBM0IsR0FBc0MsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUF6RCxFQURpQjtFQUFBLENBQW5CLENBNURBLENBQUE7O0FBQUEsRUFpRUEsS0FBSyxDQUFDLE9BQU4sQ0FBYyxRQUFkLEVBQXdCLFNBQUMsR0FBRCxFQUFNLEVBQU4sR0FBQTtBQUN0QixRQUFBLHVCQUFBO0FBQUEsSUFBQSxJQUFHLFdBQUg7QUFFRSxNQUFBLE9BQU8sQ0FBQyxLQUFSLENBQWUsaUNBQWYsQ0FBQSxDQUFBO0FBQUEsTUFDQSxZQUFZLENBQUMsSUFBYixDQUFrQixHQUFsQixDQURBLENBQUE7QUFBQSxNQUVBLE9BQU8sQ0FBQyxJQUFSLENBQUEsQ0FGQSxDQUZGO0tBQUE7QUFBQSxJQU1BLE9BQU8sQ0FBQyxJQUFSLENBQWMsd0JBQWQsQ0FOQSxDQUFBO0FBQUEsSUFPQSxLQUFBLEdBQVEsRUFBRSxDQUFDLFVBQUgsQ0FBZSxPQUFmLENBUFIsQ0FBQTtBQUFBLElBUUEsUUFBQSxHQUFXLEVBQUUsQ0FBQyxVQUFILENBQWUsVUFBZixDQVJYLENBQUE7QUFBQSxJQVVBLE1BQUEsR0FBUyxPQUFPLENBQUMsTUFBUixHQUFpQixJQUFJLENBQUMsTUFBTCxDQUFZLElBQVosRUFBa0IsU0FBQSxHQUFBO0FBQzFDLFVBQUEsSUFBQTtBQUFBLE1BQUEsSUFBQSxHQUFPLE1BQU0sQ0FBQyxPQUFQLENBQUEsQ0FBZ0IsQ0FBQyxPQUF4QixDQUFBO0FBQUEsTUFDQSxJQUFBLEdBQU8sTUFBTSxDQUFDLE9BQVAsQ0FBQSxDQUFnQixDQUFDLElBRHhCLENBQUE7YUFFQSxPQUFPLENBQUMsSUFBUixDQUFjLDJCQUFBLEdBQTZCLElBQTdCLEdBQXFDLEdBQXJDLEdBQTBDLElBQXhELEVBSDBDO0lBQUEsQ0FBbEIsQ0FWMUIsQ0FBQTtBQWVBO0FBQUE7Ozs7Ozs7Ozs7Ozs7T0FmQTtBQUFBLElBOEJBLE1BQU0sQ0FBQyxFQUFQLENBQVcsT0FBWCxFQUFtQixTQUFDLEdBQUQsR0FBQTthQUNqQixZQUFZLENBQUMsSUFBYixDQUFrQixHQUFsQixFQURpQjtJQUFBLENBQW5CLENBOUJBLENBQUE7V0FpQ0EsRUFBRSxDQUFDLEVBQUgsQ0FBTyxZQUFQLEVBQW9CLFNBQUMsTUFBRCxHQUFBO2FBQ2xCLE9BQUEsQ0FBUyxhQUFULENBQUEsQ0FBdUIsTUFBdkIsRUFEa0I7SUFBQSxDQUFwQixFQWxDc0I7RUFBQSxDQUF4QixDQWpFQSxDQUFBO0FBQUEiLCJmaWxlIjoibmVydmUuanMiLCJzb3VyY2VSb290IjoiL3NvdXJjZS8iLCJzb3VyY2VzQ29udGVudCI6WyIjIyNcbiAjIG5lcnZlXG4gIyBodHRwOi8vcjFjZWJhbmsuZ2l0aHViLmlvL05lcnZlL1xuICNcbiAjIENvcHlyaWdodCAoYykgMjAxNCByMWNlYmFua1xuICMgTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlLlxuIyMjXG5yZXF1aXJlICduZXdyZWxpYydcbmV4cHJlc3MgPSByZXF1aXJlICdleHByZXNzJ1xuYXBwID0gZXhwcmVzcygpXG5odHRwID0gcmVxdWlyZSgnaHR0cCcpLlNlcnZlcihhcHApXG5pbyA9IHJlcXVpcmUoJ3NvY2tldC5pbycpKGh0dHApXG5ib2R5UGFyc2VyID0gcmVxdWlyZSAnYm9keS1wYXJzZXInXG5tb25nbyA9IHJlcXVpcmUoJ21vbmdvZGInKS5Nb25nb0NsaWVudFxuY2hhbGsgPSByZXF1aXJlICdjaGFsaydcbndpbnN0b24gPSByZXF1aXJlICd3aW5zdG9uJ1xud2luc3Rvbi5jbGkoKVxuXG5pZiBub3QgcHJvY2Vzcy5lbnYuUFJPRFVDVElPTlxuwqDCoGNoYWxrLmVuYWJsZWQgPSB5ZXNcbsKgwqBjaGFsay5zdXBwb3J0c0NvbG9yID0geWVzXG7CoMKgd2luc3Rvbi5pbmZvICdGb3JjaW5nIGNoYWxrIGNvbG9yIHN1cHBvcnQuJ1xuXG5pZiBwcm9jZXNzLmVudi5QUk9EVUNUSU9OP1xuICByYXlndW4gPSByZXF1aXJlICdyYXlndW4nXG4gIHJheWd1bkNsaWVudCA9IG5ldyByYXlndW4uQ2xpZW50KCkuaW5pdFxuICAgIGFwaUtleTogJ01KcWZDbWhmc1Z6Szh3UjNUTUwvRnc9PSdcblxuZCA9IHJlcXVpcmUoJ2RvbWFpbicpLmNyZWF0ZSgpXG5kLm9uICdlcnJvcicsIChlcnIpIC0+XG4gIHJheWd1bkNsaWVudC5zZW5kIGVyciwge30sIC0+XG4gICAgcHJvY2Vzcy5leGl0KClcblxucG9ydCA9IHByb2Nlc3MuZW52LlBPUlQgfHwgMzkzOVxuXG5tb2R1bGUuZXhwb3J0cyA9IChvcHRpb25zKSAtPlxuICBWRVJCT1NFID0gb3B0aW9uc1xuXG5tb25nb3VybCA9ICdtb25nb2RiOi8vbmVydmVkOkNwaFY3Y2FVcGRZUlI5QGRzMDQxNTYxLm1vbmdvbGFiLmNvbTo0MTU2MS9oZXJva3VfYXBwMzM2OTUxNTcnXG5cbmd1ZXN0ID1cbiAgbmFtZTogXCJndWVzdFwiXG4gIGVtYWlsOiBcIm5lcnZlLWd1ZXN0QGdtYWlsLmNvbVwiXG4gIHByb2Zlc3Npb246IFwiZ3Vlc3RcIlxuICB0YWxlbnRzOiBcImd1ZXN0aW5nXCJcblxuYXBwLnVzZSBib2R5UGFyc2VyLnVybGVuY29kZWQgZXh0ZW5kZWQ6IGZhbHNlXG5hcHAudXNlICcvY3NzJywgZXhwcmVzcy5zdGF0aWMgcHJvY2Vzcy5jd2QoKSArICcvd3d3L2NzcydcbmFwcC51c2UgJy9pbWcnLCBleHByZXNzLnN0YXRpYyBwcm9jZXNzLmN3ZCgpICsgJy93d3cvaW1nJ1xuYXBwLnVzZSAnL2pzJywgZXhwcmVzcy5zdGF0aWMgcHJvY2Vzcy5jd2QoKSArICcvd3d3L2pzJ1xuYXBwLnVzZSAoZXJyLCByZXEsIHJlcywgbmV4dCkgLT5cbiAgcmF5Z3VuQ2xpZW50LnNlbmQgZXJyLFxuICAgIHJlcXVlc3Q6IHJlcVxuICAgIHJlc3BvbnNlOiByZXNcbiAgICBuZXh0OiBuZXh0XG5cbmFwcC5nZXQgJy8nLCAocmVxLCByZXMpIC0+XG4gIHJlcy5zZW5kRmlsZSBwcm9jZXNzLmN3ZCgpICsgJy93d3cvaW5kZXguaHRtbCdcblxuIyNtdXN0IHVzZSB4LXd3dy1mb3JtLXVybGVuY29kZWRcbmFwcC5wb3N0ICcvbG9naW4nLCAocmVxLCByZXMpIC0+XG4gIHJlcy5zZW5kIFwidXNlcjogXCIgKyByZXEuYm9keS51c2VyICsgXCIgcGFzczogXCIgKyByZXEuYm9keS5wYXNzXG5cblxuIyNDb25uZWN0IHRvIG1vbmdvZGIgc2VydmVyXG5tb25nby5jb25uZWN0IG1vbmdvdXJsLCAoZXJyLCBkYikgLT5cbiAgaWYgZXJyP1xuXG4gICAgd2luc3Rvbi5lcnJvciAnZmlsZWQgdG8gY29ubmVjdCBuZXJ2ZSBkYXRhYmFzZSdcbiAgICByYXlndW5DbGllbnQuc2VuZCBlcnJcbiAgICBwcm9jZXNzLmV4aXQoKVxuXG4gIHdpbnN0b24uaW5mbyAnY29ubmVjdGVkIHRvIGRhdGFiYXNlLidcbiAgdXNlcnMgPSBkYi5jb2xsZWN0aW9uKCd1c2VycycpXG4gIHByb2ZpbGVzID0gZGIuY29sbGVjdGlvbigncHJvZmlsZXMnKVxuXG4gIHNlcnZlciA9IGV4cG9ydHMuc2VydmVyID0gaHR0cC5saXN0ZW4gcG9ydCwgLT5cbiAgICBob3N0ID0gc2VydmVyLmFkZHJlc3MoKS5hZGRyZXNzXG4gICAgcG9ydCA9IHNlcnZlci5hZGRyZXNzKCkucG9ydFxuICAgIHdpbnN0b24uaW5mbyAnc2VydmVyIHN0YXJ0ZWQgYXQgaHR0cDovLycgKyBob3N0ICsgJzonICsgcG9ydFxuXG4gICMjI1xuICBwb3N0IHtcbiAgICBhdXRob3I6IFwiXCIsXG4gICAgdGl0bGU6IFwiXCIsXG4gICAgZGVzY3JpcHRpb246IFwiXCIsXG4gICAgdGFnczoge30sXG4gICAgcmVxdWlyZW1lbnQ6IHt9LCAvL3RhZ3MgYW5kIHJlcXVpcmVtZW50IGFyZSBhdXRvbWF0aWNhbGx5IGdlbmVyYXRlZCBhcyB1c2VyIGlucHV0XG4gICAgc3RhdHVzOiBcIlwiLFxuICAgIGNvbXA6IFwiXCIsXG4gICAgbG9jYXRpb246IFwiXCIsXG4gICAgcmVtYXJrOiBcIlwiLFxuICAgIGRhdGU6IFwiXCIsXG4gIH1cbiAgIyMjXG5cbiAgc2VydmVyLm9uICdlcnJvcicsIChlcnIpIC0+XG4gICAgcmF5Z3VuQ2xpZW50LnNlbmQgZXJyXG5cbiAgaW8ub24gJ2Nvbm5lY3Rpb24nLCAoc29ja2V0KSAtPlxuICAgIHJlcXVpcmUoJy4vZXZlbnRzLmpzJykoc29ja2V0KVxuIl19