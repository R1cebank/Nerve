(function() {
  var app, authorizedClients, bodyParser, chalk, connectedClients, d, express, getClient, guest, http, io, mongo, mongourl, port, raygun, raygunClient, server, uuid, validateClient;

  if (process.env.NODETIME_ACCOUNT_KEY != null) {
    require('nodetime').profile({
      accountKey: process.env.NODETIME_ACCOUNT_KEY,
      appName: 'nerved'
    });
  }

  raygun = require('raygun');

  raygunClient = new raygun.Client().init({
    apiKey: 'MJqfCmhfsVzK8wR3TML/Fw=='
  });

  d = require('domain').create();

  d.on('error', function(err) {
    return raygunClient.send(err, {}, function() {
      return process.exit();
    });
  });

  port = process.env.PORT || 3939;

  require('newrelic');

  express = require('express');

  app = express();

  http = require('http').Server(app);

  io = require('socket.io')(http);

  uuid = require('node-uuid');

  bodyParser = require('body-parser');

  mongo = require('mongodb').MongoClient;

  chalk = require('chalk');

  mongourl = 'mongodb://nerved:CphV7caUpdYRR9@ds041561.mongolab.com:41561/heroku_app33695157';

  connectedClients = [];

  authorizedClients = [];

  guest = {
    name: "guest",
    email: "nerve-guest@gmail.com",
    profession: "guest",
    talents: "guesting"
  };

  mongo.connect(mongourl, function(err, db) {
    if (err != null) {
      console.log(chalk.red('filed to connect nerve database'));
      raygunClient.send(err);
      process.exit();
    }
    return console.log(chalk.green('connected to database.'));
  });

  app.use(bodyParser.urlencoded({
    extended: false
  }));

  app.use('/css', express["static"](process.cwd() + '/www/css'));

  app.use('/img', express["static"](process.cwd() + '/www/img'));

  app.use('/js', express["static"](process.cwd() + '/www/js'));

  app.use(function(err, req, res, next) {
    return raygunClient.send(err, {
      request: req,
      response: res,
      next: next
    });
  });

  app.get('/', function(req, res) {
    return res.sendFile(process.cwd() + '/www/index.html');
  });

  app.post('/login', function(req, res) {
    return res.send("user: " + req.body.user + " pass: " + req.body.pass);
  });

  server = http.listen(port, function() {
    var host;
    host = server.address().address;
    port = server.address().port;
    return console.log(chalk.green('server started at http://', host, port));
  });


  /*
  post {
    author: "",
    title: "",
    description: "",
    tags: {},
    requirement: {}, //tags and requirement are automatically generated as user input
    status: "",
    comp: "",
    location: "",
    remark: "",
    date: "",
  }
   */

  getClient = function(type, element) {
    var client, _i, _len;
    for (_i = 0, _len = connectedClients.length; _i < _len; _i++) {
      client = connectedClients[_i];
      if (client[type] === element) {
        return client;
      }
    }
    return null;
  };

  validateClient = function(accessToken, uuid) {
    var client, _i, _len;
    for (_i = 0, _len = authorizedClients.length; _i < _len; _i++) {
      client = authorizedClients[_i];
      if (client['accessToken'] === accessToken) {
        return client['uuid'];
      }
    }
    return null;
  };

  server.on('error', function(err) {
    return raygunClient.send(err);
  });

  io.on('connection', function(socket) {
    var clientUUID;
    clientUUID = uuid.v1();
    connectedClients.push({
      socket: socket,
      uuid: clientUUID,
      profile: guest,
      enabled: false
    });
    socket.emit('handshake', {
      uuid: clientUUID
    });
    console.log(chalk.cyan('client is connected'));
    console.log(chalk.green('currently connected users: ' + connectedClients.length));
    socket.on('disconnect', function() {
      var currentClient, i;
      currentClient = getClient('socket', socket);
      if (currentClient != null) {
        i = connectedClients.indexOf(currentClient);
        if (i !== -1) {
          connectedClients.splice(i, 1);
          console.log(chalk.cyan('user disconnected:'));
          console.log(chalk.green(JSON.stringify(currentClient.profile)));
          return console.log(chalk.green('currently connected users: ' + connectedClients.length));
        }
      }
    });
    socket.on('login', function(data) {
      authorizedClients.push({
        uuid: 'A2wE002-10481E-21048F',
        accessToken: 'A0204E-D30EC-9201E',
        profile: guest
      });
      return console.log(chalk.cyan('client trying to login.'));
    });
    socket.on('post', function(data) {
      clientUUID = validateClient(data.accessToken);
      if (clientUUID != null) {
        return console.log(chalk.green('user ' + clientUUID + ' is allowed for action: post'));
      } else {
        return console.log(chalk.red('client is not authorized for such action'));
      }
    });
    socket.on('ping', function() {
      return console.log(chalk.blue('recieved ping from MotionDex, keep alive.'));
    });
    return socket.on('error', function(err) {
      return raygunClient.send(err);
    });
  });

}).call(this);

//# sourceMappingURL=data:application/json;base64,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QkEsQ0FBQTtBQUFBLElBNEJBLE1BQU0sQ0FBQyxFQUFQLENBQVcsTUFBWCxFQUFrQixTQUFBLEdBQUE7YUFDaEIsT0FBTyxDQUFDLEdBQVIsQ0FBWSxLQUFLLENBQUMsSUFBTixDQUFZLDJDQUFaLENBQVosRUFEZ0I7SUFBQSxDQUFsQixDQTVCQSxDQUFBO1dBOEJBLE1BQU0sQ0FBQyxFQUFQLENBQVcsT0FBWCxFQUFtQixTQUFDLEdBQUQsR0FBQTthQUNqQixZQUFZLENBQUMsSUFBYixDQUFrQixHQUFsQixFQURpQjtJQUFBLENBQW5CLEVBL0JrQjtFQUFBLENBQXBCLENBcEdBLENBQUE7QUFBQSIsImZpbGUiOiJtYWluLmpzIiwic291cmNlUm9vdCI6Ii9zb3VyY2UvIiwic291cmNlc0NvbnRlbnQiOlsiaWYgcHJvY2Vzcy5lbnYuTk9ERVRJTUVfQUNDT1VOVF9LRVk/XG4gIHJlcXVpcmUoJ25vZGV0aW1lJykucHJvZmlsZVxuICAgIGFjY291bnRLZXk6IHByb2Nlc3MuZW52Lk5PREVUSU1FX0FDQ09VTlRfS0VZLFxuICAgIGFwcE5hbWU6ICduZXJ2ZWQnXG5cbnJheWd1biA9IHJlcXVpcmUgJ3JheWd1bidcbnJheWd1bkNsaWVudCA9IG5ldyByYXlndW4uQ2xpZW50KCkuaW5pdFxuICBhcGlLZXk6ICdNSnFmQ21oZnNWeks4d1IzVE1ML0Z3PT0nXG5cbmQgPSByZXF1aXJlKCdkb21haW4nKS5jcmVhdGUoKVxuZC5vbiAnZXJyb3InLCAoZXJyKSAtPlxuICByYXlndW5DbGllbnQuc2VuZCBlcnIsIHt9LCAtPlxuICAgIHByb2Nlc3MuZXhpdCgpXG5cbnBvcnQgPSBwcm9jZXNzLmVudi5QT1JUIHx8IDM5MzlcblxucmVxdWlyZSAnbmV3cmVsaWMnXG5leHByZXNzID0gcmVxdWlyZSAnZXhwcmVzcydcbmFwcCA9IGV4cHJlc3MoKVxuaHR0cCA9IHJlcXVpcmUoJ2h0dHAnKS5TZXJ2ZXIoYXBwKVxuaW8gPSByZXF1aXJlKCdzb2NrZXQuaW8nKShodHRwKVxudXVpZCA9IHJlcXVpcmUgJ25vZGUtdXVpZCdcbmJvZHlQYXJzZXIgPSByZXF1aXJlICdib2R5LXBhcnNlcidcbm1vbmdvID0gcmVxdWlyZSgnbW9uZ29kYicpLk1vbmdvQ2xpZW50XG5jaGFsayA9IHJlcXVpcmUgJ2NoYWxrJ1xuXG5tb25nb3VybCA9ICdtb25nb2RiOi8vbmVydmVkOkNwaFY3Y2FVcGRZUlI5QGRzMDQxNTYxLm1vbmdvbGFiLmNvbTo0MTU2MS9oZXJva3VfYXBwMzM2OTUxNTcnXG5cbmNvbm5lY3RlZENsaWVudHMgPSBbXVxuYXV0aG9yaXplZENsaWVudHMgPSBbXVxuXG5ndWVzdCA9XG4gIG5hbWU6IFwiZ3Vlc3RcIlxuICBlbWFpbDogXCJuZXJ2ZS1ndWVzdEBnbWFpbC5jb21cIlxuICBwcm9mZXNzaW9uOiBcImd1ZXN0XCJcbiAgdGFsZW50czogXCJndWVzdGluZ1wiXG5cbiMjQ29ubmVjdCB0byBtb25nb2RiIHNlcnZlclxubW9uZ28uY29ubmVjdCBtb25nb3VybCwgKGVyciwgZGIpIC0+XG4gIGlmIGVycj9cblxuICAgIGNvbnNvbGUubG9nIGNoYWxrLnJlZCAnZmlsZWQgdG8gY29ubmVjdCBuZXJ2ZSBkYXRhYmFzZSdcbiAgICByYXlndW5DbGllbnQuc2VuZCBlcnJcbiAgICBwcm9jZXNzLmV4aXQoKVxuXG4gIGNvbnNvbGUubG9nIGNoYWxrLmdyZWVuICdjb25uZWN0ZWQgdG8gZGF0YWJhc2UuJ1xuXG5cbmFwcC51c2UgYm9keVBhcnNlci51cmxlbmNvZGVkIGV4dGVuZGVkOiBmYWxzZVxuYXBwLnVzZSAnL2NzcycsIGV4cHJlc3Muc3RhdGljIHByb2Nlc3MuY3dkKCkgKyAnL3d3dy9jc3MnXG5hcHAudXNlICcvaW1nJywgZXhwcmVzcy5zdGF0aWMgcHJvY2Vzcy5jd2QoKSArICcvd3d3L2ltZydcbmFwcC51c2UgJy9qcycsIGV4cHJlc3Muc3RhdGljIHByb2Nlc3MuY3dkKCkgKyAnL3d3dy9qcydcbmFwcC51c2UgKGVyciwgcmVxLCByZXMsIG5leHQpIC0+XG4gIHJheWd1bkNsaWVudC5zZW5kIGVycixcbiAgICByZXF1ZXN0OiByZXFcbiAgICByZXNwb25zZTogcmVzXG4gICAgbmV4dDogbmV4dFxuXG5hcHAuZ2V0ICcvJywgKHJlcSwgcmVzKSAtPlxuICByZXMuc2VuZEZpbGUgcHJvY2Vzcy5jd2QoKSArICcvd3d3L2luZGV4Lmh0bWwnXG5cbiMjbXVzdCB1c2UgeC13d3ctZm9ybS11cmxlbmNvZGVkXG5hcHAucG9zdCAnL2xvZ2luJywgKHJlcSwgcmVzKSAtPlxuICByZXMuc2VuZCBcInVzZXI6IFwiICsgcmVxLmJvZHkudXNlciArIFwiIHBhc3M6IFwiICsgcmVxLmJvZHkucGFzc1xuXG5zZXJ2ZXIgPSBodHRwLmxpc3RlbiBwb3J0LCAtPlxuICBob3N0ID0gc2VydmVyLmFkZHJlc3MoKS5hZGRyZXNzXG4gIHBvcnQgPSBzZXJ2ZXIuYWRkcmVzcygpLnBvcnRcbiAgY29uc29sZS5sb2cgY2hhbGsuZ3JlZW4gJ3NlcnZlciBzdGFydGVkIGF0IGh0dHA6Ly8nLCBob3N0LCBwb3J0XG5cbiMjI1xucG9zdCB7XG4gIGF1dGhvcjogXCJcIixcbiAgdGl0bGU6IFwiXCIsXG4gIGRlc2NyaXB0aW9uOiBcIlwiLFxuICB0YWdzOiB7fSxcbiAgcmVxdWlyZW1lbnQ6IHt9LCAvL3RhZ3MgYW5kIHJlcXVpcmVtZW50IGFyZSBhdXRvbWF0aWNhbGx5IGdlbmVyYXRlZCBhcyB1c2VyIGlucHV0XG4gIHN0YXR1czogXCJcIixcbiAgY29tcDogXCJcIixcbiAgbG9jYXRpb246IFwiXCIsXG4gIHJlbWFyazogXCJcIixcbiAgZGF0ZTogXCJcIixcbn1cbiMjI1xuXG5nZXRDbGllbnQgPSAodHlwZSwgZWxlbWVudCkgLT5cbiAgZm9yIGNsaWVudCBpbiBjb25uZWN0ZWRDbGllbnRzXG4gICAgaWYgY2xpZW50W3R5cGVdIGlzIGVsZW1lbnRcbiAgICAgIHJldHVybiBjbGllbnRcbiAgcmV0dXJuIG51bGxcblxudmFsaWRhdGVDbGllbnQgPSAoYWNjZXNzVG9rZW4sIHV1aWQpIC0+XG4gIGZvciBjbGllbnQgaW4gYXV0aG9yaXplZENsaWVudHNcbiAgICBpZiBjbGllbnRbJ2FjY2Vzc1Rva2VuJ10gaXMgYWNjZXNzVG9rZW5cbiAgICAgIHJldHVybiBjbGllbnRbJ3V1aWQnXVxuICByZXR1cm4gbnVsbFxuXG5zZXJ2ZXIub24gJ2Vycm9yJywgKGVycikgLT5cbiAgcmF5Z3VuQ2xpZW50LnNlbmQgZXJyXG5cbmlvLm9uICdjb25uZWN0aW9uJywgKHNvY2tldCkgLT5cbiAgY2xpZW50VVVJRCA9IHV1aWQudjEoKVxuICBjb25uZWN0ZWRDbGllbnRzLnB1c2ggc29ja2V0OiBzb2NrZXQsIHV1aWQ6IGNsaWVudFVVSUQsIHByb2ZpbGU6IGd1ZXN0LCBlbmFibGVkOiBub1xuICBzb2NrZXQuZW1pdCAnaGFuZHNoYWtlJyxcbiAgICB1dWlkOiBjbGllbnRVVUlEXG4gIGNvbnNvbGUubG9nIGNoYWxrLmN5YW4gJ2NsaWVudCBpcyBjb25uZWN0ZWQnXG4gIGNvbnNvbGUubG9nIGNoYWxrLmdyZWVuICdjdXJyZW50bHkgY29ubmVjdGVkIHVzZXJzOiAnICsgY29ubmVjdGVkQ2xpZW50cy5sZW5ndGhcbiAgc29ja2V0Lm9uICdkaXNjb25uZWN0JywgLT5cbiAgICBjdXJyZW50Q2xpZW50ID0gZ2V0Q2xpZW50ICdzb2NrZXQnLCBzb2NrZXRcbiAgICBpZiBjdXJyZW50Q2xpZW50P1xuICAgICAgaSA9IGNvbm5lY3RlZENsaWVudHMuaW5kZXhPZiBjdXJyZW50Q2xpZW50XG4gICAgICBpZiBpICE9IC0xXG4gICAgICAgIGNvbm5lY3RlZENsaWVudHMuc3BsaWNlIGksIDFcbiAgICAgICAgY29uc29sZS5sb2cgY2hhbGsuY3lhbiAndXNlciBkaXNjb25uZWN0ZWQ6J1xuICAgICAgICBjb25zb2xlLmxvZyBjaGFsay5ncmVlbiBKU09OLnN0cmluZ2lmeSBjdXJyZW50Q2xpZW50LnByb2ZpbGVcbiAgICAgICAgY29uc29sZS5sb2cgY2hhbGsuZ3JlZW4gJ2N1cnJlbnRseSBjb25uZWN0ZWQgdXNlcnM6ICcgKyBjb25uZWN0ZWRDbGllbnRzLmxlbmd0aFxuICBzb2NrZXQub24gJ2xvZ2luJywgKGRhdGEpIC0+ICMjZGF0YT17bmFtZTogJ25hbWUnLCBwYXNzd29yZDoncGFzc3dvcmQnfVxuICAgICMjTW9uZ29EYiBhY3Rpb24gaGVyZVxuICAgICMjQWNjZXNzIHRva2VuIGlzIGdlbmVyYXRlZCB1c2luZyB0aGUgdXNlcklEICsgY3VycmVudFRpbWUgKyBkZXZpY2UgaWRlbnRpZmllclxuICAgICMjXG4gICAgYXV0aG9yaXplZENsaWVudHMucHVzaCB1dWlkOiAnQTJ3RTAwMi0xMDQ4MUUtMjEwNDhGJywgYWNjZXNzVG9rZW46ICdBMDIwNEUtRDMwRUMtOTIwMUUnLCBwcm9maWxlOiBndWVzdFxuICAgIGNvbnNvbGUubG9nIGNoYWxrLmN5YW4gJ2NsaWVudCB0cnlpbmcgdG8gbG9naW4uJ1xuICBzb2NrZXQub24gJ3Bvc3QnLCAoZGF0YSkgLT4gIyN7dGl0bGU6ICcnLCBkZXNjcmlwdGlvbjogJycsIGRhdGU6ICcnLCB0YWdzOicnLCBza2lsbHM6JycsY29tcDogJycsIGxvY2F0aW9uOicnLCBleHBpcmU6JycsIHJlbWFya3M6JycsIGFjY2Vzc1Rva2VuOicnLCB1dWlkOicnfVxuICAgIGNsaWVudFVVSUQgPSB2YWxpZGF0ZUNsaWVudCBkYXRhLmFjY2Vzc1Rva2VuXG4gICAgaWYgY2xpZW50VVVJRD9cbiAgICAgICMjUG9zdCBzdHVmZlxuICAgICAgY29uc29sZS5sb2cgY2hhbGsuZ3JlZW4gJ3VzZXIgJyArIGNsaWVudFVVSUQgKyAnIGlzIGFsbG93ZWQgZm9yIGFjdGlvbjogcG9zdCdcbiAgICBlbHNlXG4gICAgICBjb25zb2xlLmxvZyBjaGFsay5yZWQgJ2NsaWVudCBpcyBub3QgYXV0aG9yaXplZCBmb3Igc3VjaCBhY3Rpb24nXG4gIHNvY2tldC5vbiAncGluZycsIC0+XG4gICAgY29uc29sZS5sb2cgY2hhbGsuYmx1ZSAncmVjaWV2ZWQgcGluZyBmcm9tIE1vdGlvbkRleCwga2VlcCBhbGl2ZS4nXG4gIHNvY2tldC5vbiAnZXJyb3InLCAoZXJyKSAtPlxuICAgIHJheWd1bkNsaWVudC5zZW5kIGVyclxuIl19